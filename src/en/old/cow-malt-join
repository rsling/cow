#!/bin/bash

maltf=$1
lemf=$2

gunzip -c $maltf | \
    sed '1 s/^.*$/&\n/' | \
    sed '/^1	!<s_~_/ { s/_~_/ /g; s/^1	!\(<[^>]\+>\).\+$/\1/ }' | \
    sed '/^</! { s/\&/\&amp;/g; s/"/\&quot;/g; s/'"'"'/\&apos;/g; }' | \
    paste - $lemf | \
    cut -f 1,2,4,7,8,11 | \
    sed '/^</! { s/\([^	]\+\)	\([^	]\+\)	\([^	]\+\)	\([^	]\+\)	\([^	]\+\)	\([^	]\+\)/\2	\3	\6	\1	\4	\5/}' | \
    sed '1! s/^<s/<\/s>\n&/' | \
    sed '/^\s*$/d' | \
    sed -e "\$a<\/s>" 
